## Vis√£o Geral

Um CRUD de ‚ÄúEventos Extremos‚Äù para gerenciar usu√°rios, bairros e ocorr√™ncias (alagamentos, deslizamentos etc.) rodando em Oracle e com UI de terminal estilosa. Feito pra quem curte CLI power user: entradas por *prompt*, logs coloridos com Rich e dados seguros criptografados.

### Por que ‚ÄúEventos Extremos‚Äù?

Porque aqui n√£o √© s√≥ ‚Äúcriar-ler-atualizar-deletar‚Äù‚Äî√© sobre monitorar √°reas de risco (bairros), registrar quem cuida de cada ocorr√™ncia e exportar tudo pra JSON. √â um sistema leve, mas feito com cuidado: Oracle no backend, SQLModel/Pydantic para modelos, Rich pro front e Typer (se quiser evoluir).

---

## Tecnologias e Depend√™ncias

Lista enxuta, mas potente:

* **Python 3.10+**
* **SQLModel** (modelagem Pydantic + SQLAlchemy)
* **oracledb** (conex√£o Oracle)
* **Pydantic** (valida√ß√£o de dados)
* **Typer** (CLI caseiro, opcional/expand√≠vel)
* **Tabulate** (tabelas bonitas no terminal)
* **Cryptography** (criptografia de credenciais)
* **Rich** (UI de terminal estilosa)

**requirements.txt**:

```
sqlmodel
oracledb
pydantic
typer
tabulate
cryptography
rich
```

---

## Estrutura de Pastas

```
backend/
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ connection.py      # Conex√£o segura Oracle + criptografia de credenciais
‚îÇ   ‚îî‚îÄ‚îÄ models.py          # SQLModel: Usuario, Bairro, Ocorrencia
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ crud_usuario.py    # L√≥gica CRUD (DDL, INSERT, SELECT, UPDATE, DELETE)
‚îÇ   ‚îî‚îÄ‚îÄ utils.py           # Fun√ß√£o de valida√ß√£o de data
‚îú‚îÄ‚îÄ ui.py              # Fun√ß√µes de interface com Rich (pain√©is, menus, loading fake) 
‚îú‚îÄ‚îÄ logger.py              # Logger customizado (arquivo + Rich no terminal)
‚îú‚îÄ‚îÄ main.py                # Entrypoint: menu principal, loop de op√ß√µes, chamadas de servi√ßo
‚îî‚îÄ‚îÄ create_tables.py       # Script standalone para criar as tabelas no Oracle
requirements.txt
```

* **database/connection.py**

  * Gera e l√™ uma `key.key` para criptografar credenciais (usu√°rio, senha, DSN).
  * Se n√£o encontrar `db_config.json`, solicita usu√°rio e senha no terminal (`getpass`), criptografa e salva.
  * `get_connection()` retorna uma conex√£o Oracle v√°lida (ou loop de cadastro se falhar).
* **database/models.py**

  * `Usuario`: id, nome, papel, email.
  * `Bairro`: id, nome, propor√ß√£o de √°rea de risco, densidade populacional.
  * `Ocorrencia`: id, t√≠tulo, descri√ß√£o (CLOB), categoria, data (DATE), status, localiza√ß√£o, refer√™ncias a `usuario_id` e `bairro_id`.
* **services/crud\_usuario.py**

  * DDL declarados como strings para criar tabelas (`usuario`, `bairro`, `ocorrencia`).
  * Fun√ß√µes:

    * `criar_tabelas()`: executa DDLs (ignora se j√° existe).
    * `criar_usuario`, `listar_usuarios`.
    * `criar_bairro`, `listar_bairros`.
    * `criar_ocorrencia`, `listar_ocorrencias` (faz JOIN com usu√°rio e bairro, converte LOB para string).
    * `buscar_ocorrencias_por_categoria`.
    * `atualizar_ocorrencia` (constr√≥i UPDATE din√¢mico; cuida do campo `data`).
    * `deletar_ocorrencia`.
    * `exportar_ocorrencias_json`: salva todas as ocorr√™ncias em `backend/export/ocorrencias_export.json`.
* **services/utils.py**

  * `validar_data(formato: str, data_str: str)`: usa `datetime.strptime` pra checar formato `YYYY-MM-DD`.
* **ui/ui.py**

  * Fun√ß√µes com Rich:

    * `loading_fake(texto)`: spinner + barra de progresso fake pra dar sensa√ß√£o de ‚Äúcarregando‚Äù.
    * `linha(texto)`: rule estilizada.
    * `sucesso(msg)`, `erro(msg)`, `alerta(msg)`, `info(msg)`: prints coloridos com √≠cones.
    * `painel(texto, titulo)`: painel de Rich com borda colorida.
    * `menu(titulo, opcoes: list)`: exibe op√ß√µes numeradas, retorno como string.
    * `input_pastel(texto)`: input estilizado.
    * `pause()`: ‚ÄúPressione Enter para continuar‚Ä¶‚Äù.
* **logger.py**

  * `elo_logger`: captura todos os n√≠veis (`DEBUG` pra cima).
  * `FileHandler` grava em `elo.log` com formato `[DD/MM/YYYY HH:MM:SS] [N√çVEL] Mensagem`.
  * Fun√ß√µes de log customizadas:

    * `log_info(msg)`: grava `INFO` e imprime num tom azul pastel.
    * `log_sucesso(msg)`: grava `INFO` com tag `[SUCESSO]` e printa com √≠cone de check.
    * `log_erro(msg)`: grava `ERROR` e printa em vermelho.
    * `log_alerta(msg)`: `WARNING` e printa em cor pastel.
    * `log_critico(msg)`: `CRITICAL` e painel vermelho no terminal.
* **main.py**

  * Loop principal: limpa a tela (`cls`/`clear`), exibe painel ‚ÄúBem-vindo ao ELO!‚Äù e mostra menu com 10 op√ß√µes (0 pra sair).
  * Cada op√ß√£o mapeia pra uma fun√ß√£o CRUD do `services/crud_usuario`.

    1. Listar usu√°rios ‚Üí usa `tabulate` para exibir.
    2. Criar usu√°rio ‚Üí valida inputs; faz `criar_usuario(...)`; log e mensagem de sucesso/erro.
    3. Listar bairros.
    4. Criar bairro ‚Üí converte strings num√©ricas (√°rea de risco, densidade); valida `float`.
    5. Listar ocorr√™ncias (com JOIN de nomes).
    6. Criar ocorr√™ncia ‚Üí valida data (`validar_data`); converte `usuario_id` e `bairro_id` pra `int`; chama `criar_ocorrencia(...)`.
    7. Buscar ocorr√™ncias por categoria ‚Üí retorna lista e exibe com `tabulate`.
    8. Atualizar ocorr√™ncia ‚Üí l√™ `id`, l√™ `campo` (t√≠tulo, descri√ß√£o, categoria, data, status, localizacao); valida; chama `atualizar_ocorrencia`.
    9. Deletar ocorr√™ncia.
    10. Exportar ocorr√™ncias para JSON (`exportar_ocorrencias_json`).
  * Em cada fluxo, logs de a√ß√µes do usu√°rio e logs de erros.
  * Ao final, imprime ‚ÄúPrograma encerrado‚Äù e finaliza.
* **create\_tables.py**

  * Simples: executa `criar_tabelas()` e imprime ‚ÄúTabelas criadas com sucesso!‚Äù (ponto √∫nico de entrada para criar DDL via CLI).

---

## Como Rodar (Setup)


1. **Crie e ative um virtualenv**

   ```bash
   python3 -m venv .venv
   source .venv/bin/activate     # macOS/Linux
   .venv\Scripts\activate        # Windows
   ```

2. **Instale as depend√™ncias**

   ```bash
   pip install --upgrade pip
   pip install -r requirements.txt
   ```

3. **Configurar credenciais Oracle**

   * Ao rodar pela primeira vez qualquer script que invoque `get_connection()` (por exemplo, `python create_tables.py`), a aplica√ß√£o vai pedir:

     ```
     Usu√°rio:
     Senha (n√£o aparece ao digitar):
     ```
   * Insira suas credenciais. Isso gera:

     * `key.key`: chave Fernet para criptografia.
     * `db_config.json`: contendo usu√°rio, senha, DSN criptografados.
   * **Importante**: **NUNCA** compartilhe `key.key` e `db_config.json` publicamente.

4. **Criar as tabelas**

   ```bash
   python create_tables.py
   ```

   Deve exibir:

   ```
   üü¢ Conex√£o com Oracle realizada com sucesso!
   Tabelas criadas com sucesso!
   ```

   Se a tabela j√° existir, o script ignora e segue em frente (com DDL dentro de `crud_usuario.py`).

5. **Executar a aplica√ß√£o**

   ```bash
   python main.py
   ```

   Voc√™ ver√° o menu principal no terminal. Basta digitar o n√∫mero da a√ß√£o desejada (0‚Äì10).

---

## Exemplos de Uso

> **Listar Bairros**
>
> 1. Selecione ‚Äú3‚Äù no menu.
> 2. Aguarde o loading fake.
> 3. Se houver bairros cadastrados, aparece tabela como:
>
>    ```
>    ‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
>    ‚îÉ id  ‚îÉ nome           ‚îÉ area_risco_prop   ‚îÉ pop_densidade ‚îÉ
>    ‚î°‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î©
>    ‚îÇ 1   ‚îÇ Vila Linda     ‚îÇ 0.35              ‚îÇ 12000.0       ‚îÇ
>    ‚îÇ 2   ‚îÇ Alto da Serra  ‚îÇ 0.80              ‚îÇ 5000.0        ‚îÇ
>    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
>    ```

> **Criar Ocorr√™ncia**
>
> 1. Selecione ‚Äú6‚Äù no menu.
> 2. Preencha t√≠tulo, descri√ß√£o, categoria (ex: `alagamento`), data (`YYYY-MM-DD`), status, local de refer√™ncia, IDs de `usuario` e `bairro`.
> 3. Se data estiver no formato errado, avisa com `erro(...)` e volta para o menu.
> 4. Ao sucesso:
>
>    ```
>    :white_check_mark: Ocorr√™ncia criada com ID 5
>    ```

> **Exportar para JSON**
>
> 1. Selecione ‚Äú10‚Äù no menu.
> 2. A pasta `backend/export` ser√° criada (se n√£o existir) e o arquivo `ocorrencias_export.json` salvo l√°.
> 3. Mensagem de sucesso:
>
>    ```
>    :white_check_mark: Exportado para ./export/ocorrencias_export.json
>    ```

---

## Detalhes T√©cnicos e Dicas de Desenvolvimento

1. **Conex√£o + Seguran√ßa**

   * `get_connection()` primeiro busca `db_config.json`; se n√£o existe, chama `cadastrar_login()` pra criptografar e salvar credenciais com `cryptography.Fernet`.
   * O DSN padr√£o √© vazio, mas voc√™ pode mudar no c√≥digo ou inserir outro DSN no cadastro.
   * Em caso de falha no `ping()`, solicita recadastro autom√°tico.

2. **Modelos SQLModel**

   * `Usuario`, `Bairro` e `Ocorrencia` s√£o classes que herdam de `SQLModel, table=True`.
   * Chaves prim√°rias geradas automaticamente (`IDENTITY`).
   * `Ocorrencia.data` √© uma string no modelo, mas convertida para `DATE` no SQL via `TO_DATE(:data, 'YYYY-MM-DD')`.

3. **CRUD e DDL**

   * O DDL (CREATE TABLE) fica em `crud_usuario.py`. No `criar_tabelas()`, cada DDL √© executado (= ‚ÄúIF NOT EXISTS‚Äù manual).
   * M√©todos de inser√ß√£o usam `RETURNING id INTO :id_out` pra retornar o PK gerado.
   * `listar_ocorrencias()` faz JOIN com `usuario` e `bairro`, converte eventual LOB (`CLOB`) pra string Python.

4. **Valida√ß√£o de Data**

   * `validar_data("%Y-%m-%d", data)` retorna `True/False`. Se `False`, n√£o deixa inserir ou atualizar.

5. **Logger Customizado**

   * Qualquer a√ß√£o (criar, listar, erro, etc.) faz `log_info`, `log_sucesso`, `log_erro` ou `log_alerta`.
   * O arquivo `elo.log` recebe registros no formato `25/04/2025 14:35:12 INFO    Usu√°rio criou bairro: ID 3, Nome: Centro`.
   * No terminal, as mensagens aparecem coloridas com Rich, painel em caso de `log_critico`.

6. **Interface de Terminal (Rich)**

   * `ui.menu()`: exibe n√∫mero + descri√ß√£o, al√©m de op√ß√£o ‚Äú0 ‚Äì Sair‚Äù.
   * `loading_fake()`: spinner + barra de progresso, s√≥ pra zoeira visual.
   * Fun√ß√µes de arte (painel, linha) deixam a CLI com cara de dashboard.

---

## Resumo R√°pido para Devs

1. **venv**, **pip install -r requirements.txt**.
2. **python create\_tables.py** (cadastre credenciais FIAP quando solicitado).
3. **python main.py** e interaja com o menu.
4. Logs ‚Üí `elo.log`; exporta√ß√µes ‚Üí `backend/export/ocorrencias_export.json`.

> Pronto! Agora voc√™ tem um CRUD de ‚ÄúEventos Extremos‚Äù bala, com backend Oracle, modelos SQLModel, valida√ß√£o Pydantic, CLI Rich pastel, logs profissa e export JSON. Sem frescura.
